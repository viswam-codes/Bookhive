<%- include('../partials/adminHeader.ejs') %>

<body>
  <div class="screen-overlay"></div>
  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top">
      <a href="index.html" class="brand-wrap">
        <img
          src="/admin_assets/imgs/theme/logo.svg"
          class="logo"
          alt="Evara Dashboard"
        />
      </a>
      <div>
        <button class="btn btn-icon btn-aside-minimize">
          <i class="text-muted material-icons md-menu_open"></i>
        </button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item">
          <a class="menu-link" href="/admin/home">
            <i class="icon material-icons md-home"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/user_management">
            <i class="icon material-icons md-person"></i>
            <span class="text">User Management</span>
          </a>
        </li>
        <li class="menu-item active">
          <a class="menu-link" href="/admin/product_management">
            <i class="icon material-icons md-shopping_bag"></i>
            <span class="text">Products Management</span>
          </a>
        </li>
        <li class="menu-item">
          <a class="menu-link" href="/admin/category_management">
            <i class="icon material-icons md-stars"></i>
            <span class="text">Category Management</span>
          </a>
        </li>
      </ul>
      <hr />
      <ul class="menu-aside">
        <li class="menu-item has-submenu">
          <a class="menu-link" href="#">
            <i class="icon material-icons md-settings"></i>
            <span class="text">Settings</span>
          </a>
          <div class="submenu">
            <a href="page-settings-1.html">Setting sample 1</a>
            <a href="page-settings-2.html">Setting sample 2</a>
          </div>
        </li>
      </ul>
      <br />
      <br />
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search">
        <!-- <form class="searchform">
          <div class="input-group">
            <input list="search_terms" type="text" class="form-control" placeholder="Search term">
            <button class="btn btn-light bg" type="button"> <i class="material-icons md-search"></i></button>
          </div>
          <datalist id="search_terms">
            <option value="Products">
            <option value="New orders">
            <option value="Apple iphone">
            <option value="Ahmed Hassan">
          </datalist>
        </form> -->
      </div>
      <div class="col-nav">
        <button
          class="btn btn-icon btn-mobile me-auto"
          data-trigger="#offcanvas_aside"
        >
          <i class="material-icons md-apps"></i>
        </button>
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link btn-icon" href="#">
              <i class="material-icons md-notifications animation-shake"></i>
              <span class="badge rounded-pill">3</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link btn-icon darkmode" href="#">
              <i class="material-icons md-nights_stay"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="requestfullscreen nav-link btn-icon"
              ><i class="material-icons md-cast"></i
            ></a>
          </li>
          <li class="dropdown nav-item">
            <a
              class="dropdown-toggle"
              data-bs-toggle="dropdown"
              href="#"
              id="dropdownLanguage"
              aria-expanded="false"
              ><i class="material-icons md-public"></i
            ></a>
            <div
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="dropdownLanguage"
            >
              <a class="dropdown-item text-brand" href="#"
                ><img
                  src="assets/imgs/theme/flag-us.png"
                  alt="English"
                />English</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-fr.png"
                  alt="Français"
                />Français</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-jp.png"
                  alt="Français"
                />日本語</a
              >
              <a class="dropdown-item" href="#"
                ><img
                  src="assets/imgs/theme/flag-cn.png"
                  alt="Français"
                />中国人</a
              >
            </div>
          </li>
          <li class="dropdown nav-item">
            <a
              class="dropdown-toggle"
              data-bs-toggle="dropdown"
              href="#"
              id="dropdownAccount"
              aria-expanded="false"
            >
              <img
                class="img-xs rounded-circle"
                src="assets/imgs/people/avatar2.jpg"
                alt="User"
            /></a>
            <div
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="dropdownAccount"
            >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-perm_identity"></i>Edit Profile</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-settings"></i>Account Settings</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-account_balance_wallet"></i
                >Wallet</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-receipt"></i>Billing</a
              >
              <a class="dropdown-item" href="#"
                ><i class="material-icons md-help_outline"></i>Help center</a
              >
              <div class="dropdown-divider"></div>
              <a class="dropdown-item text-danger" href="#"
                ><i class="material-icons md-exit_to_app"></i>Logout</a
              >
            </div>
          </li>
        </ul>
      </div>
    </header>
    <section class="content-main">
      <div class="row">
        <div class="col-9">
          <div class="content-header">
            <h2 class="content-title">Add New Product</h2>
            <!-- <div>
                        <button class="btn btn-light rounded font-sm mr-5 text-body hover-up">Save to draft</button>
                        <button type="submit" class="btn btn-md rounded font-sm hover-up">Publish</button>
                    </div> -->
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card mb-4">
            <div class="card-header">
              <h4>Basic</h4>
            </div>
            <div class="card-body">
              <form
                action="/admin/add_product"
                method="post"
                enctype="multipart/form-data"
                id="addProductForm"
              >
                <div class="mb-4">
                  <label for="product_name" class="form-label">Title</label>
                  <input
                    type="text"
                    placeholder="Type here"
                    class="form-control"
                    id="product_name"
                    name="title"
                  />
                  <div id="usernameError" class="error-message"></div>
                </div>
                <div class="mb-4">
                  <label for="author" class="form-label">Author</label>
                  <input
                    type="text"
                    placeholder="Type here"
                    class="form-control"
                    id="author"
                    name="author"
                  />
                  <div id="authorError" class="error-message"></div>
                </div>
                <div class="mb-4">
                  <label class="form-label">Full description</label>
                  <textarea
                    placeholder="Type here"
                    id="description"
                    class="form-control"
                    rows="4"
                    name="description"
                  ></textarea>
                  <div id="descriptionError" class="error-message"></div>
                </div>
                <div class="row">
                  <div class="col-lg-4">
                    <div class="mb-4">
                      <label class="form-label">Regular price</label>
                      <div class="row gx-2">
                        <input
                          placeholder="Enter Price"
                          type="text"
                          id="price"
                          class="form-control"
                          name="price"
                        />
                        <div id="priceError" class="error-message"></div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-4">
                      <label class="form-label">Stock</label>
                      <input
                        placeholder="Enter the Quantity"
                        type="text"
                        class="form-control"
                        name="stock"
                        id="stock"
                      />
                      <div id="stockError" class="error-message"></div>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="mb-4">
                      <label class="form-label" required>Category</label>
                      <select class="form-select" name="category">
                        <% cat.forEach(function(cats) { %>
                        <option><%=cats.name %></option>
                        <% }); %>
                      </select>
                      <div id="categoryError" class="error-message"></div>
                    </div>
                  </div>
                </div>
                <div class="card mb-4">
                  <div class="card-header">
                    <h4>Media</h4>
                  </div>
                  <div class="card-body">
                    <div class="input-upload">
                      <input
                        class="form-control"
                        type="file"
                        name="image"
                        id="image"
                        multiple
                      />
                    </div>
                    <div id="imageError" class="error-message"></div>
                  </div>
                </div>
                <div class="card mb-4;">
                  <div class="card-header">
                      <h4>Image Preview</h4>
                  </div>
                  <div class="card-body" style="overflow-x: auto;">
                      <div id="image-preview" style="display: flex; flex-wrap: wrap;">
                          <!-- Placeholder for image preview -->
                      </div>
                  </div>
              </div>

                <button
                  type="submit"
                  class="btn btn-md rounded font-sm hover-up"
                  value="Upload"
                  onclick="return validateForm()"
                >
                  Publish
                </button>
              </form>
            </div>
          </div>
          <!-- card end// -->
        </div>
      </div>
      <script>
        function previewImages() {
          var preview = document.getElementById("image-preview");
          var files = document.querySelector("input[type=file]").files;

          preview.innerHTML = ""; // Clear existing preview

          // Loop through selected files
          for (var i = 0; i < files.length; i++) {
            var file = files[i];
            var reader = new FileReader();

            // Closure to capture the file information
            reader.onload = (function (file) {
              return function (e) {
                // Create image element
                var img = document.createElement("img");
                img.src = e.target.result;
                img.classList.add("img-fluid", "mb-2");
                preview.appendChild(img);
              };
            })(file);

            // Read in the image file as a data URL
            reader.readAsDataURL(file);
          }
        }

        // Bind previewImages function to file input change event
        document
          .querySelector("input[type=file]")
          .addEventListener("change", previewImages);
      </script>

      <script>
     function validateForm() {
    var title = document.getElementById("product_name").value;
    var author = document.getElementById("author").value;
    var description = document.getElementById("description").value;
    var price = document.getElementById("price").value;
    var stock = document.getElementById("stock").value;
    var image = document.getElementById("image").value;
    var category = document.querySelector('select[name="category"]').value;
    var valid = true;

    // Username validation
    if (!title) {
        document.getElementById("usernameError").innerText = "Title is required";
        document.getElementById("usernameError").style.color = "red"; // Set color to red
        valid = false;
    } else {
        document.getElementById("usernameError").innerText = "";
    }

    if (!author) {
        document.getElementById("authorError").innerText = "Author is required";
        document.getElementById("authorError").style.color = "red"; // Set color to red
        valid = false;
    } else {
        document.getElementById("authorError").innerText = "";
    }

    if (!description) {
        document.getElementById("descriptionError").innerText = "Description is required";
        document.getElementById("descriptionError").style.color = "red";
        valid = false;
    } else {
        document.getElementById("descriptionError").innerText = "";
    }

    if (!price || parseFloat(price) < 0) {
        document.getElementById("priceError").innerText = "Price must be a non-negative number";
        document.getElementById("priceError").style.color = "red";
        valid = false;
    } else {
        document.getElementById("priceError").innerText = "";
    }

    if (!stock || parseFloat(stock) < 0) {
        document.getElementById("stockError").innerText = "Stock must be a non-negative number";
        document.getElementById("stockError").style.color = "red";
        valid = false;
    } else {
        document.getElementById("stockError").innerText = "";
    }

    if (!category) {
        document.getElementById("categoryError").innerText = "Category is required";
        document.getElementById("categoryError").style.color = "red";
        valid = false;
    } else {
        document.getElementById("categoryError").innerText = "";
    }

    // Image validation
    if (!image) {
        document.getElementById("imageError").innerText = "Image is required";
        document.getElementById("imageError").style.color = "red";
        valid = false;
    } else {
        var allowedExtensions = /(\.jpeg|\.jpg|\.png|\.webp)$/i;
        if (!allowedExtensions.exec(image)) {
            document.getElementById("imageError").innerText = "Only files with extensions .jpeg, .jpg, .png, .webp are allowed";
            document.getElementById("imageError").style.color = "red";
            valid = false;
        } else {
            document.getElementById("imageError").innerText = "";
        }
    }

    // Password validation
    if (!valid) {
        return false;
    }
}


     // Function to update image preview container size and layout
// Function to update image preview container size and layout
function updateImagePreview() {
    const imagePreview = document.getElementById('image-preview');
    const input = document.getElementById('image');
    const images = input.files;

    // Clear previous images
    imagePreview.innerHTML = '';

    // Loop through selected images
    for (let i = 0; i < images.length; i++) {
        const reader = new FileReader();

        reader.onload = function(e) {
            // Create image element
            const img = document.createElement('img');
            img.src = e.target.result;
            img.alt = 'Image Preview';
            img.style.maxWidth = '100px'; // Adjust as needed
            img.style.maxHeight = '100px'; // Adjust as needed
            img.style.margin = '5px'; // Adjust as needed

            // Append image to preview
            imagePreview.appendChild(img);
        };

        // Read image as Data URL
        reader.readAsDataURL(images[i]);
    }

    // Adjust the size of the image preview container
    adjustImagePreviewSize();
}

// Function to adjust the size of the image preview container
function adjustImagePreviewSize() {
    const imagePreview = document.getElementById('image-preview');
    const images = imagePreview.querySelectorAll('img');

    // Calculate the number of images per row
    const imagesPerRow = 2;

    // Calculate the width of the container based on the number of images per row
    const containerWidth = imagesPerRow * (images.length > 0 ? images[0].clientWidth + 10 : 0); // 10px margin between images

    // Set the width of the image preview container
    imagePreview.style.width = containerWidth + 'px';
}

// Call the updateImagePreview function when the page loads and when new images are selected
document.addEventListener('DOMContentLoaded', updateImagePreview);
document.getElementById('image').addEventListener('change', updateImagePreview);

  


      </script>
    </section>
    <%- include('../partials/adminFooter.ejs') %>
  </main>
</body>
