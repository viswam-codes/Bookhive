<%- include('../partials/userHeader.ejs') %>
<style>
/* Hide navigation dots */
.slick-dots {
  display: none !important;
}

/* Hide navigation arrows */
.slick-prev,
.slick-next {
  display: none !important;
}

.product-image-figure {
  width: 500px; /* set a medium-sized width for the div */
  height: 500px; /* set a medium-sized height for the div */
  display: inline-block; /* make the div shrink to fit the image */
  overflow: hidden; /* hide any excess image size */
}

.product-image-figure img.mainImage {
  width: 100%; /* scale the image to fit the div's width */
  height: 100%; /* scale the image to fit the div's height */
  object-fit: contain; /* fit the image inside the div while maintaining aspect ratio */
  display: block; /* remove any extra space below the image */
  margin: 0 auto; /* center the image horizontally */
}
</style>
<style>
    .quantity-container {
            display: flex;
            align-items: center;
        }
        .quantity-button {
           
            color: black;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
            margin: 0 5px;
            padding: 10px;
            transition: background-color 0.3s;
        }
        .quantity-button:hover {
            background-color: #088178;
            color: white;
        }
        .quantity-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .quantity-input {
            width: 50px;
            text-align: center;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            margin: 0 5px;
        }
</style>



<div class="mobile-header-active mobile-header-wrapper-style">
  <div class="mobile-header-wrapper-inner">
    <div class="mobile-header-top">
      <div class="mobile-header-logo">
        <a href="index.html"><img src="user_assets/imgs/theme/logo.svg" alt="logo"></a>
      </div>
      <div class="mobile-menu-close close-style-wrap close-style-position-inherit">
        <button class="close-style search-close">
          <i class="icon-top"></i>
          <i class="icon-bottom"></i>
        </button>
      </div>
    </div>
    <div class="mobile-header-content-area">
      <div class="mobile-search search-style-3 mobile-header-border">
        <form action="#">
          <input type="text" placeholder="Search for items…">
          <button type="submit"><i class="fi-rs-search"></i></button>
        </form>
      </div>
      <div class="mobile-menu-wrap mobile-header-border">
        <div class="main-categori-wrap mobile-header-border">
          <a class="categori-button-active-2" href="#">
            <span class="fi-rs-apps"></span> Browse Categories
          </a>
          <div class="categori-dropdown-wrap categori-dropdown-active-small">
            <ul>
              <li><a href="shop-grid-right.html"><i class="evara-font-dress"></i>Women's Clothing</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-tshirt"></i>Men's Clothing</a></li>
              <li> <a href="shop-grid-right.html"><i class="evara-font-smartphone"></i> Cellphones</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-desktop"></i>Computer & Office</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-cpu"></i>Consumer Electronics</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-home"></i>Home & Garden</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-high-heels"></i>Shoes</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-teddy-bear"></i>Mother & Kids</a></li>
              <li><a href="shop-grid-right.html"><i class="evara-font-kite"></i>Outdoor fun</a></li>
            </ul>
          </div>
        </div>
        <!-- mobile menu start -->
        <nav>
          <ul class="mobile-menu">
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="index.html">Home</a>
              <ul class="dropdown">
                <li><a href="index.html">Home 1</a></li>
                <li><a href="index-2.html">Home 2</a></li>
                <li><a href="index-3.html">Home 3</a></li>
                <li><a href="index-4.html">Home 4</a></li>
              </ul>
            </li>
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="shop-grid-right.html">shop</a>
              <ul class="dropdown">
                <li><a href="shop-grid-right.html">Shop Grid – Right Sidebar</a></li>
                <li><a href="shop-grid-left.html">Shop Grid – Left Sidebar</a></li>
                <li><a href="shop-list-right.html">Shop List – Right Sidebar</a></li>
                <li><a href="shop-list-left.html">Shop List – Left Sidebar</a></li>
                <li><a href="shop-fullwidth.html">Shop - Wide</a></li>
                <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product</a>
                  <ul class="dropdown">
                    <li><a href="shop-product-right.html">Product – Right Sidebar</a></li>
                    <li><a href="shop-product-left.html">Product – Left Sidebar</a></li>
                    <li><a href="shop-product-full.html">Product – No sidebar</a></li>
                  </ul>
                </li>
                <li><a href="shop-filter.html">Shop – Filter</a></li>
                <li><a href="shop-wishlist.html">Shop – Wishlist</a></li>
                <li><a href="shop-cart.html">Shop – Cart</a></li>
                <li><a href="shop-checkout.html">Shop – Checkout</a></li>
                <li><a href="shop-compare.html">Shop – Compare</a></li>
              </ul>
            </li>
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Mega menu</a>
              <ul class="dropdown">
                <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Women's Fashion</a>
                  <ul class="dropdown">
                    <li><a href="shop-product-right.html">Dresses</a></li>
                    <li><a href="shop-product-right.html">Blouses & Shirts</a></li>
                    <li><a href="shop-product-right.html">Hoodies & Sweatshirts</a></li>
                    <li><a href="shop-product-right.html">Women's Sets</a></li>
                  </ul>
                </li>
                <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Men's Fashion</a>
                  <ul class="dropdown">
                    <li><a href="shop-product-right.html">Jackets</a></li>
                    <li><a href="shop-product-right.html">Casual Faux Leather</a></li>
                    <li><a href="shop-product-right.html">Genuine Leather</a></li>
                  </ul>
                </li>
                <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Technology</a>
                  <ul class="dropdown">
                    <li><a href="shop-product-right.html">Gaming Laptops</a></li>
                    <li><a href="shop-product-right.html">Ultraslim Laptops</a></li>
                    <li><a href="shop-product-right.html">Tablets</a></li>
                    <li><a href="shop-product-right.html">Laptop Accessories</a></li>
                    <li><a href="shop-product-right.html">Tablet Accessories</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="blog-category-fullwidth.html">Blog</a>
              <ul class="dropdown">
                <li><a href="blog-category-grid.html">Blog Category Grid</a></li>
                <li><a href="blog-category-list.html">Blog Category List</a></li>
                <li><a href="blog-category-big.html">Blog Category Big</a></li>
                <li><a href="blog-category-fullwidth.html">Blog Category Wide</a></li>
                <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Single Product Layout</a>
                  <ul class="dropdown">
                    <li><a href="blog-post-left.html">Left Sidebar</a></li>
                    <li><a href="blog-post-right.html">Right Sidebar</a></li>
                    <li><a href="blog-post-fullwidth.html">No Sidebar</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Pages</a>
              <ul class="dropdown">
                <li><a href="page-about.html">About Us</a></li>
                <li><a href="page-contact.html">Contact</a></li>
                <li><a href="page-account.html">My Account</a></li>
                <li><a href="page-login-register.html">login/register</a></li>
                <li><a href="page-purchase-guide.html">Purchase Guide</a></li>
                <li><a href="page-privacy-policy.html">Privacy Policy</a></li>
                <li><a href="page-terms.html">Terms of Service</a></li>
                <li><a href="page-404.html">404 Page</a></li>
              </ul>
            </li>
            <li class="menu-item-has-children"><span class="menu-expand"></span><a href="#">Language</a>
              <ul class="dropdown">
                <li><a href="#">English</a></li>
                <li><a href="#">French</a></li>
                <li><a href="#">German</a></li>
                <li><a href="#">Spanish</a></li>
              </ul>
            </li>
          </ul>
        </nav>
        <!-- mobile menu end -->
      </div>
      <div class="mobile-header-info-wrap mobile-header-border">
        <div class="single-mobile-header-info mt-30">
          <a href="page-contact.html"> Our location </a>
        </div>
        <div class="single-mobile-header-info">
          <a href="page-login-register.html">Log In / Sign Up </a>
        </div>
        <div class="single-mobile-header-info">
          <a href="#">(+01) - 2345 - 6789 </a>
        </div>
      </div>
      <div class="mobile-social-icon">
        <h5 class="mb-15 text-grey-4">Follow Us</h5>
        <a href="#"><img src="user_assets/imgs/theme/icons/icon-facebook.svg" alt=""></a>
        <a href="#"><img src="user_assets/imgs/theme/icons/icon-twitter.svg" alt=""></a>
        <a href="#"><img src="user_assets/imgs/theme/icons/icon-instagram.svg" alt=""></a>
        <a href="#"><img src="user_assets/imgs/theme/icons/icon-pinterest.svg" alt=""></a>
        <a href="#"><img src="user_assets/imgs/theme/icons/icon-youtube.svg" alt=""></a>
      </div>
    </div>
  </div>
</div>
<main class="main">
  <div class="page-header breadcrumb-wrap">
    <div class="container">
      <div class="breadcrumb">
        <a href="/" rel="nofollow">Home</a>
        <span></span> <a href="/shop_page" rel="nofollow">Shop</a>
        <span></span> <%=pro.title %>
      </div>
    </div>
  </div>
  <section class="mt-50 mb-50">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="product-detail accordion-detail">
            <div class="row mb-50">
              <div class="col-md-6 col-sm-12 col-xs-12">
              
                  <!-- MAIN SLIDES -->
                  <div class="product-image-slider">
                    <% pro.image.forEach(function(img, index) { %>
                    <div class="product-image-figure">
                      <img class="mainImage" src="/uploads/<%= img %>" alt="product image" data-index="<%= index %>">
                    </div>
                    <% }); %>
                  </div>

                  <!-- THUMBNAILS -->
                  <div class="slider-nav-thumbnails">
                    <% pro.image.forEach(function(img) { %>
                    <div class="thumbnail">
                      <img src="/uploads/<%= img %>" alt="product image">
                    </div>
                    <% }); %>
                  </div>
             

                <!-- End Gallery -->
              </div>

              <div class="col-md-6 col-sm-12 col-xs-12">

                <div class="detail-info">
                  <h2 class="title-detail"><%=pro.title %></h2>
                  <div class="product-detail-rating">
                    <div class="pro-details-brand">
                      <span> Category: <a href="shop-grid-right.html"><%=pro.category %></a></span>
                    </div>
                    <div class="product-rate-cover text-end">
                      <div class="product-rate d-inline-block">
                        <div class="product-rating" style="width:90%">
                        </div>
                      </div>
                      <span class="font-small ml-5 text-muted"> (25 reviews)</span>
                    </div>
                  </div>
                  <% if(pro.discountPrice>0) { %>
                  <div class="clearfix product-price-cover">
                    <div class="product-price primary-color float-left">
                      <ins><span class="text-brand"><%=pro.discountPrice %></span></ins>
                      <ins><span class="old-price font-md ml-15"><%=pro.price %></span></ins>
                      <span class="save-price  font-md color3 ml-15"><%= (Math.floor(((pro.price-pro.discountPrice)/pro.price)*100)) %>% Off</span>
                    </div>
                  </div>

                  <% } else { %>

                  <div class="clearfix product-price-cover">
                    <div class="product-price primary-color float-left">
                      <ins><span class="text-brand"><%=pro.price %></span></ins>


                    </div>
                  </div>

                  <% } %>

                  <div class="bt-1 border-color-1 mt-15 mb-15"></div>
                  <div class="short-desc mb-30">
                    <p><%=pro.description %></p>
                  </div>
                  <div class="product_sort_info font-xs mb-30">
                    <ul>
                      <li><i class="fi-rs-credit-card mr-5"></i> Cash on Delivery available</li>
                    </ul>
                  </div>

                  <div class="bt-1 border-color-1 mt-30 mb-30"></div>
                  <div class="detail-extralink">
                    <div class="quantity-container">
                      <button class="quantity-button" id="decrement">-</button>
                      <input type="text" id="quantity" data-product-stock="<%=pro.stock %>" class="quantity-input" value="1" readonly>
                      <button class="quantity-button" id="increment" >+</button>
                  </div>
                    <div class="product-extra-link2">
                      <button type="submit" class="button button-add-to-cart" onclick="addToCart('<%=user._id%>','<%=pro._id %>')">Add to cart</button>
                      <a aria-label="Add To Wishlist" class="action-btn hover-up"onclick="addToWhish('<%=pro._id %>')"><i class="fi-rs-heart"></i></a>
                      <a aria-label="Compare" class="action-btn hover-up" href="shop-compare.html"><i class="fi-rs-shuffle"></i></a>
                    </div>
                    <input type="hidden" id="error-message" class="error-message" value="Quantity exceeds available stock.">

                  </div>
                  <ul class="product-meta font-xs color-grey mt-50">
                    <li>Availability:<span class="in-stock text-success ml-5"><%=pro.stock %> Items In Stock</span></li>
                  </ul>
                </div>

                <!-- Detail Info -->
              </div>
            </div>
            <div class="row mt-60">
              <div class="col-12">
                <h3 class="section-title style-1 mb-30">Related products</h3>
              </div>
              <div class="col-12">
                <div class="row related-products">
                  <% relProduct.forEach(function(prod)  { %>
                  <div class="col-lg-3 col-md-4 col-12 col-sm-6">
                    <div class="product-cart-wrap small hover-up">
                      <div class="product-img-action-wrap">
                        <div class="product-img product-img-zoom">
                          <a href="/product_page?id=<%=prod._id%>" tabindex="0">

                            <img class="default-img" src="/uploads/<%= prod.image[0] %>" alt="">
                            <img class="hover-img" src="/uploads/<%= prod.image[0] %>" alt="">
                          </a>
                        </div>

                      </div>
                      <div class="product-content-wrap">
                        <h2><a href="shop-product-right.html" tabindex="0"><%=prod.title %></a></h2>
                        <div class="rating-result" title="90%">
                          <span>
                          </span>
                        </div>
                        <div class="product-price">
                          <span><%=prod.price%> </span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <% }); %>

                </div>
              </div>
            </div>
        
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10">

<!-- SweetAlert JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>



<script>


    // Initialize global variables
    const minValue = 1;
    const proStock = parseInt(document.getElementById('quantity').getAttribute('data-product-stock'));
    let quantity = 1;
    const maxValue=10;

    // DOM elements
    const quantityInput = document.getElementById('quantity');
    const decrementButton = document.getElementById('decrement');
    const incrementButton = document.getElementById('increment');
    const errorMessage = document.getElementById('error-message');
    

    // Update button states based on the current quantity
    function updateButtons() {
        decrementButton.disabled = quantity <= minValue;
        incrementButton.disabled = quantity >= proStock;
        incrementButton.disabled = quantity >= maxValue;
    }

  
    // Increment the quantity
    function incrementValue() {
        if (quantity < proStock) {
            quantity++;
            quantityInput.value = quantity;
            updateButtons();
          
        }
    }

    // Decrement the quantity
    function decrementValue() {
        if (quantity > minValue) {
            quantity--;
            quantityInput.value = quantity;
            updateButtons();
        }
    }

    // Event listeners for the buttons
    decrementButton.addEventListener('click', decrementValue);
    incrementButton.addEventListener('click', incrementValue);

    // Initial button state update
    updateButtons();








  function addToCart(userId, productId) {
    fetch(`/addToCart?userId=${userId}&productId=${productId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ quantity: quantity })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        // Handle success response
        if (data.success) {
            Swal.fire({
                title: 'Product Added to Cart',
                text: 'Do you want to visit the cart?',
                icon: 'success',
                showCancelButton: true,
                confirmButtonText: 'Visit Cart',
                cancelButtonText: 'Wait'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = "/cart";
                } else {
                    console.log('User chose to wait');
                }
            });
        } else {
            Swal.fire({
                title: "Oops",
                text: data.message,
                icon: "warning",
                showCloseButton: true, // Show close button
                confirmButtonText: 'Close' // Button text
            });
        }


        // Optionally, you can redirect the user to the cart page or show a success message
      })
      .catch(error => {
        // Handle error
        console.error('There was a problem with your fetch operation:', error);
      });
  }

  function addToWhish(productId){

fetch(`/addToWishList?productId=${productId}`, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    }
})
.then(response => {
    if (!response.ok) {
        throw new Error('Network response was not ok');
    }
    return response.json();
})
.then(data => {
    // Handle success response
    if(data.success){
      Swal.fire({
                title: "Success",
                text: data.message,
                icon: "success",
                showCloseButton: true, // Show close button
                confirmButtonText: 'Close' // Button text
            }); 
        console.log('Added to WishList:');
    }else{
      Swal.fire({
                title: "Oops",
                text: data.message,
                icon: "warning",
                showCloseButton: true, // Show close button
                confirmButtonText: 'Close' // Button text
            });  

    }

    
    
    // Optionally, you can redirect the user to the cart page or show a success message
})
.catch(error => {
    // Handle error
    console.error('There was a problem with your fetch operation:', error);
});
}
</script>


<script>
  $(document).ready(function() {
    $('.product-image-slider').slick({
      slidesToShow: 1,
      slidesToScroll: 1,
      arrows: true,
      fade: true,
      asNavFor: '.slider-nav-thumbnails'
    });

    $('.slider-nav-thumbnails').slick({
      slidesToShow: 4,
      slidesToScroll: 1,
      asNavFor: '.product-image-slider',
      dots: true,
      centerMode: true,
      focusOnSelect: true
    });

    // Remove active class from all thumbnail slides
    $('.slider-nav-thumbnails .slick-slide').removeClass('slick-active');

    // Set active class to first thumbnail slides
    $('.slider-nav-thumbnails .slick-slide').eq(0).addClass('slick-active');

    // On before slide change match active thumbnail to current slide
    $('.product-image-slider').on('beforeChange', function(event, slick, currentSlide, nextSlide) {
      var mySlideNumber = nextSlide;
      $('.slider-nav-thumbnails .slick-slide').removeClass('slick-active');
      $('.slider-nav-thumbnails .slick-slide').eq(mySlideNumber).addClass('slick-active');
    });

    // Initialize ElevateZoom for the first image
    function initializeZoom(imageElement) {
      // Remove the old zoom instance
      $('.zoomContainer').remove();
      imageElement.removeData('elevateZoom');

      // Initialize new zoom instance
      imageElement.elevateZoom({
        zoomType: "window",
        zoomWindowWidth: 500,
        zoomWindowHeight: 500,
        borderSize: 4,
        borderColour: "#888",
        zoomWindowPosition: 1,
       
      });
    }

    // Initialize zoom on the first image
    initializeZoom($('.mainImage').eq(0));

    // Re-initialize zoom when slide changes
    $('.product-image-slider').on('afterChange', function(event, slick, currentSlide) {
      var currentImage = $('.mainImage').eq(currentSlide);
      initializeZoom(currentImage);
    });
  });
</script>
</body>


<%- include('../partials/userFooter.ejs') %>